# CTR模型使用指南

## 快速开始

### 1. 收集CTR数据
```bash
# 启动检索系统
python run_demo.py

# 在界面中进行搜索和点击操作
# 点击"📊 导出CTR数据"按钮导出数据
```

### 2. 训练逻辑回归CTR模型
```bash
# 训练模型
python online/ctr_lr_model.py
```

### 3. 查看结果
- `ctr_lr_results.png`: 可视化图表
- `ctr_lr_analysis_report.md`: 详细分析报告
- `ctr_lr_model.pkl`: 训练好的模型

## 数据格式

### 输入数据 (CSV格式)
```csv
timestamp,query,doc_id,position,score,doc_length,clicked,summary,full_content
2024-01-01 10:00:00,人工智能,doc1,1,0.85,150,1,人工智能是...,人工智能是计算机科学...
2024-01-01 10:00:00,人工智能,doc2,2,0.72,200,0,机器学习是...,机器学习是人工智能...
```

### 特征说明
- `position`: 展示位置 (1-10)
- `score`: 相似度分数
- `doc_length`: 文档长度
- `clicked`: 点击标签 (0/1)

## 模型特点

### 逻辑回归优势
1. **可解释性强**: 系数直接表示特征影响
2. **训练速度快**: 适合实时更新
3. **内存占用小**: 适合大规模部署
4. **概率输出**: 直接输出点击概率

### 特征工程
- **位置特征**: position (绝对位置), position_decay (1/(位置+1))
- **相似度特征**: tfidf_score (原始TF-IDF分数)
- **匹配特征**: match_score (查询词匹配度)
- **历史CTR特征**: query_ctr, doc_ctr (历史点击率)
- **长度特征**: query_length, doc_length, summary_length

## 应用场景

### 1. 搜索结果重排序
```python
# 结合CTR预测调整排序
final_score = alpha * similarity_score + beta * ctr_prediction
```

### 2. 推荐系统
- 预测用户对推荐内容的点击概率
- 优化推荐策略

### 3. 广告投放
- 优化广告展示位置
- 提高广告点击率

## 模型评估

### 主要指标
- **AUC**: 模型区分能力
- **Log Loss**: 预测概率质量
- **Accuracy**: 分类准确率

### 业务指标
- CTR提升
- 用户满意度
- 转化率

## 最佳实践

### 1. 数据收集
- 确保数据质量
- 平衡正负样本
- 收集足够样本

### 2. 特征工程
- 尝试不同特征组合
- 处理缺失值
- 特征标准化

### 3. 模型更新
- 定期重新训练
- 监控性能变化
- A/B测试验证

### 4. 部署建议
- 使用pickle保存模型
- 实现在线预测接口
- 监控模型效果

## 故障排除

### 常见问题
1. **数据不足**: 收集更多点击数据
2. **特征稀疏**: 增加特征工程
3. **过拟合**: 调整正则化参数
4. **欠拟合**: 增加特征或降低正则化

### 调试建议
- 检查数据质量
- 分析特征重要性
- 可视化预测结果
- 对比基线模型 